<div class="container">
  <header class="header">
    <h1>{{ title }}</h1>
    
    <!-- Burger menu icon for mobile -->
    <button class="burger-menu" (click)="toggleMobileMenu()" aria-label="Menu">
      <span class="burger-line"></span>
      <span class="burger-line"></span>
      <span class="burger-line"></span>
    </button>
    
    <!-- Desktop/Tablet buttons -->
    <div class="header-actions">
      <button class="btn btn-success" (click)="addNewRow()">
        <span class="icon">‚ûï</span> Add Item
      </button>
      <button class="btn btn-info" (click)="openSummaryReport()">
        <span class="icon">üìä</span> Summary Report
      </button>
      <button class="btn btn-warning" (click)="openStatistics()">
        <span class="icon">üìà</span> Statistics
      </button>
      <button class="btn btn-primary" (click)="saveToExcel()">
        <span class="icon">üíæ</span> Save
      </button>
      <button class="btn btn-secondary" (click)="exitApp()">
        <span class="icon">üö™</span> Exit
      </button>
    </div>
  </header>

  <!-- Mobile menu -->
  <div class="mobile-menu" [class.active]="showMobileMenu">
    <div class="mobile-menu-overlay" (click)="toggleMobileMenu()"></div>
    <div class="mobile-menu-content">
      <button class="mobile-menu-item btn-success" (click)="addNewRow(); toggleMobileMenu()">
        <span class="icon">‚ûï</span> Add Item
      </button>
      <button class="mobile-menu-item btn-info" (click)="openSummaryReport(); toggleMobileMenu()">
        <span class="icon">üìä</span> Summary Report
      </button>
      <button class="mobile-menu-item btn-warning" (click)="openStatistics(); toggleMobileMenu()">
        <span class="icon">üìà</span> Statistics
      </button>
      <button class="mobile-menu-item btn-primary" (click)="saveToExcel(); toggleMobileMenu()">
        <span class="icon">üíæ</span> Save
      </button>
      <button class="mobile-menu-item btn-secondary" (click)="exitApp(); toggleMobileMenu()">
        <span class="icon">üö™</span> Exit
      </button>
    </div>
  </div>

  <div class="search-section">
    <div class="search-box">
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (input)="onSearch()" 
        placeholder="Search grocery items..."
        class="search-input"
      />
      <span class="search-icon">üîç</span>
    </div>
    <div class="filter-controls">
      <label class="filter-checkbox">
        <input 
          type="checkbox" 
          [(ngModel)]="showOnlyUnpicked"
          (change)="onSearch()"
        />
        <span>Show only unpicked items</span>
      </label>
    </div>
    <div class="info">
      <span class="total-count">
        Total: {{ filteredData.length }} items
      </span>
    </div>
  </div>

  <div class="table-container">
    <table class="data-table" *ngIf="displayedData.length > 0">
      <thead>
        <tr>
          <th>Picked Up</th>
          <th>Category</th>
          <th>Product Name</th>
          <th>Brand</th>
          <th>Size / Details</th>
          <th>Quantity</th>
          <th>Price (CAD)</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of displayedData; let i = index" [class.picked-up-row]="item['Picked Up']">
          <td class="checkbox-col">
            <input 
              type="checkbox" 
              [(ngModel)]="item['Picked Up']"
            />
          </td>
          <td>
            <select [(ngModel)]="item.Category" class="input-field">
              <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
            </select>
          </td>
          <td>
            <input type="text" [(ngModel)]="item['Product Name']" class="input-field" />
          </td>
          <td>
            <input type="text" [(ngModel)]="item.Brand" class="input-field" />
          </td>
          <td>
            <input type="text" [(ngModel)]="item['Size / Details']" class="input-field" />
          </td>
          <td>
            <input type="number" [(ngModel)]="item.Quantity" class="input-field input-number" />
          </td>
          <td>
            <input type="number" [(ngModel)]="item['Price (CAD)']" step="0.01" class="input-field input-number" />
          </td>
          <td class="actions-col">
            <button class="btn-delete" (click)="deleteRow(item)" title="Delete">
              üóëÔ∏è
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="no-data" *ngIf="displayedData.length === 0">
      <p>No data found</p>
    </div>
  </div>

  <div class="pagination" *ngIf="totalPages > 1">
    <button 
      class="btn-page" 
      (click)="previousPage()" 
      [disabled]="currentPage === 1"
    >
      ‚Äπ Previous
    </button>
    
    <div class="page-numbers">
      <button 
        *ngFor="let page of pageNumbers" 
        class="btn-page-number" 
        [class.active]="page === currentPage"
        (click)="onPageChange(page)"
      >
        {{ page }}
      </button>
    </div>
    
    <button 
      class="btn-page" 
      (click)="nextPage()" 
      [disabled]="currentPage === totalPages"
    >
      Next ‚Ä∫
    </button>
  </div>

  <div class="pagination-info">
    Showing {{ (currentPage - 1) * itemsPerPage + 1 }} - 
    {{ Math.min(currentPage * itemsPerPage, filteredData.length) }} 
    of {{ filteredData.length }} items
  </div>
</div>

<!-- Summary Report Modal -->
<div class="modal-overlay" *ngIf="showSummaryModal" (click)="closeSummaryModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Grocery Summary Report</h2>
      <button class="btn-close" (click)="closeSummaryModal()">‚úï</button>
    </div>
    
    <div class="modal-body">
      <div class="summary-info">
        <div class="summary-row">
          <label>Estimated Cost:</label>
          <span class="cost-value">${{ getEstimatedCost().toFixed(2) }}</span>
        </div>
      </div>

      <div class="form-group">
        <label for="summaryDate">Date of Grocery Shopping:</label>
        <input 
          type="date" 
          id="summaryDate"
          [(ngModel)]="summaryDate" 
          class="form-control"
        />
      </div>

      <div class="form-group">
        <label for="summaryStore">Store:</label>
        <select 
          id="summaryStore"
          [(ngModel)]="summaryStore" 
          class="form-control"
        >
          <option *ngFor="let store of stores" [value]="store">{{ store }}</option>
        </select>
      </div>

      <div class="form-group">
        <label for="actualCost">Actual Cost:</label>
        <input 
          type="number" 
          id="actualCost"
          [(ngModel)]="summaryActualCost" 
          step="0.01"
          placeholder="Enter actual cost"
          class="form-control"
        />
      </div>

      <div class="summary-info" *ngIf="summaryActualCost > 0">
        <div class="summary-row">
          <label>Difference:</label>
          <span class="cost-value" [class.positive]="summaryActualCost < getEstimatedCost()" [class.negative]="summaryActualCost > getEstimatedCost()">
            ${{ (summaryActualCost - getEstimatedCost()).toFixed(2) }}
          </span>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeSummaryModal()">Cancel</button>
      <button class="btn btn-primary" (click)="saveSummary()" [disabled]="!summaryDate || summaryActualCost <= 0">Save Summary</button>
    </div>
  </div>
</div>
<!-- Summary Report Modal -->
<div class="modal-overlay" *ngIf="showSummaryModal" (click)="closeSummaryModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Grocery Summary Report</h2>
      <button class="btn-close" (click)="closeSummaryModal()">‚úï</button>
    </div>
    
    <div class="modal-body">
      <div class="summary-info">
        <div class="summary-row">
          <label>Estimated Cost:</label>
          <span class="cost-value">${{ getEstimatedCost().toFixed(2) }}</span>
        </div>
      </div>

      <div class="form-group">
        <label for="summaryDate">Date of Grocery Shopping:</label>
        <input 
          type="date" 
          id="summaryDate"
          [(ngModel)]="summaryDate" 
          class="form-control"
        />
      </div>

      <div class="form-group">
        <label for="summaryStore">Store:</label>
        <select 
          id="summaryStore"
          [(ngModel)]="summaryStore" 
          class="form-control"
        >
          <option *ngFor="let store of stores" [value]="store">{{ store }}</option>
        </select>
      </div>

      <div class="form-group">
        <label for="actualCost">Actual Cost:</label>
        <input 
          type="number" 
          id="actualCost"
          [(ngModel)]="summaryActualCost" 
          step="0.01"
          placeholder="Enter actual cost"
          class="form-control"
        />
      </div>

      <div class="summary-info" *ngIf="summaryActualCost > 0">
        <div class="summary-row">
          <label>Difference:</label>
          <span class="cost-value" [class.positive]="summaryActualCost < getEstimatedCost()" [class.negative]="summaryActualCost > getEstimatedCost()">
            ${{ (summaryActualCost - getEstimatedCost()).toFixed(2) }}
          </span>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeSummaryModal()">Cancel</button>
      <button class="btn btn-primary" (click)="saveSummary()" [disabled]="!summaryDate || summaryActualCost <= 0">Save Summary</button>
    </div>
  </div>
</div>

 
 <!-- Statistics Modal -->
<div class="modal-overlay" *ngIf="showStatisticsModal" (click)="closeStatisticsModal()">
  <div class="modal-content modal-large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>üìà Grocery Statistics</h2>
      <button class="btn-close" (click)="closeStatisticsModal()">‚úï</button>
    </div>
    
    <div class="modal-body">
      <div *ngIf="grocerySummaries.length === 0" class="no-data-message">
        <p>üìä No summary data available yet.</p>
        <p>Create a summary report first to see statistics!</p>
      </div>

      <div *ngIf="grocerySummaries.length > 0" class="statistics-container">
        <h3>Estimated vs Actual Costs by Store</h3>
        
        <div class="chart-container" *ngFor="let stat of getStoreStatistics()">
          <div class="store-name">{{ stat.store }} ({{ stat.count }} visit<span *ngIf="stat.count > 1">s</span>)</div>
          
          <div class="bar-chart">
            <div class="bar-row">
              <div class="bar-label">Estimated:</div>
              <div class="bar-wrapper">
                <div class="bar bar-estimated" [style.width.%]="getBarWidth(stat.estimatedTotal)">
                  <span class="bar-value">${{ stat.estimatedTotal.toFixed(2) }}</span>
                </div>
              </div>
            </div>
            
            <div class="bar-row">
              <div class="bar-label">Actual:</div>
              <div class="bar-wrapper">
                <div class="bar bar-actual" [style.width.%]="getBarWidth(stat.actualTotal)">
                  <span class="bar-value">${{ stat.actualTotal.toFixed(2) }}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="stats-summary">
            <div class="stat-item">
              <span class="stat-label">Avg Estimated:</span>
              <span class="stat-value">${{ stat.estimatedAvg.toFixed(2) }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Avg Actual:</span>
              <span class="stat-value">${{ stat.actualAvg.toFixed(2) }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Difference:</span>
              <span class="stat-value" [class.positive]="stat.difference < 0" [class.negative]="stat.difference > 0">
                ${{ stat.difference.toFixed(2) }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeStatisticsModal()">Close</button>
    </div>
  </div>
</div>
